/****************************************************************************************************/
/*                                           INCLUDE                                                */
/****************************************************************************************************/
#define _GNU_SOURCE 
#include <stdio.h>
#include <stdlib.h>
#include <dlfcn.h>

/****************************************************************************************************/
/*                                           DEFINES                                                */
/****************************************************************************************************/

/****************************************************************************************************/
/*                                           VARIABLES                                              */
/****************************************************************************************************/
static void* (*real_malloc)(size_t) = NULL;
static void (*real_free)(void*) = NULL;
/****************************************************************************************************/
/*                                       STATIC FUNCTIONS                                           */
/****************************************************************************************************/

/****************************************************************************************************/
/*                                       PUBLIC FUNCTIONS                                           */
/****************************************************************************************************/
void* malloc(size_t size) {
	printf("Enter my malloc\n");
    if (!real_malloc) {
        real_malloc = dlsym(RTLD_NEXT, "malloc");
    }
    void* ptr = real_malloc(size);
    printf("malloc(%u) = %p\n", size, ptr);
    return ptr;
}

void free(void* ptr) {
	printf("Enter my free\n");
    if (!real_free) {
        real_free = dlsym(RTLD_NEXT, "free");
    }
    printf("free(%p)\n", ptr);
    real_free(ptr);
}
